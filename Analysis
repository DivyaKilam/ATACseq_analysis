ATAC-seq used to detect chromatin accessibility across the genome. Allows access to open chromatin regions by allowing to insert sequencing adapters with the help of Tn5 transposase. Sequencing reads can be used to access regions of chromatin. It is a fast and sensitive alternative to DNA-seq for assaying chromatin accessibility or to access nucleosome positions in the genome. DNA compaction sequesters the inactive regions of the genome and leaves biologically active regions like promoters, enhancers accessible to the transcription machinery.  
Paired end sequencing preferred as more sequence data leads to better alignment and helps reduce alignment ambiguity. DNA fragement generated by ATAC is typically longer than the sequence read. The fragment is known precisely in paired-end sequencing since it generates reads from both ends. Also, paired-end sequencing leads to generation of fewer duplicates 

https://informatics.fas.harvard.edu/atac-seq-guidelines.html
https://academic.oup.com/bioinformatics/advance-article/doi/10.1093/bioinformatics/bty141/4924216
http://informatics1.rc.fas.harvard.edu/atac-workshop-capellini-lab.html
file:///C:/Users/divya/Data-Partition/MS%20Bioinformatics%20JHU/ATAC%20analysis/ATAC-seq.pdf
https://github.com/ParkerLab/bioinf525
https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3959825/

## downloading sample dataset from SRA
SRA: SRR891268
http://www.ncbi.nlm.nih.gov/sra?term=SRX298000
##gets files with first and second reads of the pair
$ fastq-dump --gzip --split-files SRR891268


Basic quality check- 
1. FastQC
./fastqc

##fastq-mcf program that does both adapter trimming and removing low quality bases
https://github.com/ExpressionAnalysis/ea-utils/blob/wiki/FastqMcf.md 

2. Adapter trimming- Reads derived from short DNA fragements, may contain adapters.
ngmerge- https://github.com/jsh58/NGmerge/blob/master/UserGuide.pdf
NGmerge is based on the principle that, with paired-end sequencing, adapter contamination occurs only when both reads fully overlap. The program tests each pair of reads for overlap, and in cases where they do, it clips the 3' overhangs of both reads. It basically aligns the reads and clips overhangs.
$ NGmerge -1 file1.fastq.gz -2 file2.fastq.gz -o file -a
The command takes in the two files of paired end reads and outputs a file after removing the adapter sequences. -a is adapter removal mode.

Fastqc check after NGmerge again showed adapter content so I tried another adapter trimming wrapper script Trim Galore
perl trim_galore --paired file1.fastq.gz file2.fastq.gz

Parker script
https://github.com/ParkerLab/atactk/blob/master/scripts/trim_adapters
trim_adapters file1 file2
Fastqc check showed adapter trimming with lesser bias for other traits.

Mapping to hg19- using bowtie2
##index the reference sequence
bowtie2-build -f hg19.fa
bowtie2 -x hg19 -L 20 -p 4 -1 file1 -2 file2 -S file.sam

https://github.com/harvardinformatics/ATAC-seq#next
SamTools- properly paired reads with high mapping quality
Non unique alignments like short sequences reads may align equally well to multiple locations due to the repetitive nature of the genome. The -q parameter of samtools view to eliminate reads with low mapping quality (MAPQ) score. To remove scores less than 10 one can use
samtools view -bS -q 10 -o file.bam file.sam
samtools view file.bam | head
samtools sort -o file.sorted.bam file.bam
samtools flagstat file.sorted.bam
samtools index file.sorted.bam

##Duplicate read removalcan be done by
1. samtools markdup
first sort the bam file
then use fixmate to add tags which can later be used by markdup
samtools fixmate -m file.bam file_fixmate.bam
samtools sort -o file_positionsort.bam file_fixmate.bam
samtools markdup file_positionsort.bam file_markdup.bam
(shows some error and generates file in bytes)

2.Picard tools MarkDuplicates program (http://broadinstitute.github.io/picard/)
PCR duplicates that are exact copies of DNA fragments can arise during PCR. Since they occur during library preparation they may interfere with the biological signal of interest. PCR duplicates can be removed in Picard's MarkDuplicates.
module load picard
M= gives list of duplicates identified.
Picard is a command line tool for manipulating high-throughput sequencing data in formats such as SAM/BAM.
MarkDuplicates identifies duplicate reads in SAM or BAM file, where duplicate reads originate from a single fragement of DNA

##Run after sorting the file by samtools
java -jar picard.jar MarkDuplicates I=in_file.bam O=out_file.bam M=dups.txt REMOVE_DUPLICATES=true

## Index the BAM file
Index the BAM file that has been produced from picard after removal of PCR duplicates

Peak Calling
Peak identification- macs2  --nomodel --shift -100 --extsize 200
HTSeq- fragments were counted across each peak region
differentially accessible peaks identified with edgeR


https://github.com/QuKunLab/ATAC-pipe

##DESeq2 // MA plot
https://bioinformatics.uconn.edu/resources-and-events/tutorials-2/rna-seq-tutorial-with-reference-genome/#
